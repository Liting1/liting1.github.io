<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
		.box {
			width: 500px;
		}
		.box table {
			width: 100%;
			text-align: center;
			/* border: solid 1px #ccc; */
		}
		td {
			/* display: block; */
		}
		.box table a {
			display:  block;
			text-decoration: none;
			width: 100%;
			height: 100%;
		}
	</style>
</head>
<body>
	<div class="box"></div>
	<div class="btns">
		<button>计算总成绩</button>
		<button>根据语文成绩排序</button>
		<button>根据数学成绩排序</button>
		<button>根据英语成绩排序</button>
	</div>
	<script>
	var data = {
		header: ['学号', '语文', '数学', '英语', '总成绩', '备注','/','/'],
		body:[{
			id: 1,
			language: 77,
			math: 88,
			english: 67,
			sum: '',
			note: ''
		}, {
			id: 2,
			language: 47,
			math: 88,
			english: 12,
			sum: '',
			note: ''
		}, {
			id: 3,
			language: 76,
			math: 57,
			english: 76,
			sum: '',
			note: ''
		}, {
			id: 4,
			language: 89,
			math: 45,
			english: 66,
			sum: '',
			note: ''
		}, {
			id: 5,
			language: 80,
			math: 95,
			english: 22,
			sum: '',
			note: ''
		}, {
			id: 6,
			language: 70,
			math: 80,
			english: 33,
			sum: '',
			note: ''
		}, {
			id: 7,
			language: 85,
			math: 93,
			english: 44,
			sum: '',
			note: ''
		}, {
			id: 8,
			language: 73,
			math: 84,
			english: 55,
			sum: '',
			note: ''
		}]
	}
		/**
		 * [render 渲染表格数据]
		 * @return {[type]} [没有返回值]
		 */
		function render() {
			var header = data.header.map(function(item){
				return `<th>${item}</th>`
			}).join('');
			var body = data.body.map(function(item, index){
				return `<tr>
							<td>${item.id}</td>
							<td>${item.language}</td>
							<td>${item.math}</td>
							<td>${item.english}</td>
							<td>${item.sum}</td>
							<td>${item.note}</td>
							<td data-delete='${index}'><a href="javascript:;">删除</a></td>
							<td data-copy='${index}'><a href="javascript:;">复制</a></td>
						</tr>`;
			}).join('');
			var str = `
				<table border="1" cellspacing="0">
					<thead><tr>${header}</tr></thead>
					<tbody>${body}</tbody>
				</table>`;
				document.querySelector('.box').innerHTML = str;
		}
		render()
		
		/**
		 * [sum 计算总成绩]
		 * @return {[type]} [underfined]
		 */
		function sum(){
			data.body.forEach(function(item){
				item.sum = item.language+item.math+item.english;
				if(item.sum>=240){
					item.note = '优秀';
				} else if(item.sum>=200) {
					item.note = '良好';
				} else {
					item.note = '无';
				}
			})
		}

		

		/**
		 * [objSort 根据对象的某个字段进行排序]
		 * @param  {[string]} a    [需要排序的字段]
		 * @param  {[Boolean]} bool [默认升序排序]
		 * @return {[type]}      [没有返回值]
		 */
		function objSort(a, bool) {
			data.body.sort(function(n1,n2){
				return !bool ? n1[a]-n2[a] : n2[a]-n1[a];
			});
		}

		// 显示成绩总分
		document.querySelector('.btns button:nth-child(1)').onclick = function(){
			sum();
			render();
		}
		document.querySelector('.btns button:nth-child(2)').onclick = function(){
			objSort('language');
			render();
		}
		document.querySelector('.btns button:nth-child(3)').onclick = function(){
			objSort('math');
			render();
		}
		document.querySelector('.btns button:nth-child(4)').onclick = function(){
			objSort('english');
			render();
		}

		document.querySelector('.box').onclick = function(e){
			e = e || event;
			// 删除数组元素
			var deleteIndex = e.target.parentNode.dataset.delete;
			var copyIndex = e.target.parentNode.dataset.copy;
			// console.log(e.target.parentNode.parentNode)
			if(deleteIndex !== undefined) {
				data.body.splice(deleteIndex,1)
				render();
			}
			if(copyIndex !== undefined) {
				var dom = e.target.parentNode.parentNode;
				var td = dom.children;
				data.body.splice(copyIndex,0,{
					id: content(td[0]),
					language: content(td[1]),
					math: content(td[2]),
					english: content(td[3]),
					sum: content(td[4],1),
					note: content(td[5],1)
				});
				render();
			}

		}
		function content(d, t) {
			return !t ? (+d.textContent) : d.textContent;
		}
	</script>
</body>
</html>